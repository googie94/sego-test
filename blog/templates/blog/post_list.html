{% extends 'blog/base.html' %}
{% load static %}
{% block content %}


<div id="postApp" class="bt50" v-cloak>
	
	<div class="intro">
		<div>
			<p class="hello">Hello!ğŸ‘‹</p> 
		</div>
		<br>
		<div>
			<p style="font-size: 13px; line-height: 1.6em;">í•˜ê³  ì‹¶ì€ ë§ë“¤ì€ ìŒ“ì—¬ê°€ëŠ”ë°,<br>ì¹œêµ¬ë“¤ì—ê²Œ í•˜ê¸°ì—” ë‚¯ê°„ì§€ëŸ½ê³ ,<br>íšŒì‚¬ ì‚¬ëŒë“¤ì—ê² í•˜ê¸° ì–´ë ¤ìš´ ê·¸ëŸ° ë§ë“¤</p>
		</div>
	</div>

	<div class="hitpost">
		<div>
			<p class="hitsego">sego</p>
		</div>
		<div class="hit-content">
			<ul>
				<li v-for="hit_post in hit_posts">
					<a :href="'/post/'+hit_post.id+'/'">
						<p>[[ hit_post.title ]]</p>
					</a>
				</li>
			</ul>
			<ul v-if="hit_posts.length==0">
				<li v-for="hit_post in 5">
					<a><p></p></a>
				</li>
			</ul>
		</div>
	</div>

	<div class="main-feeds">
		<br>
		<div style="padding: 20px;">
			<p class="feeds">Feeds</p>
		</div>
		<div style="display: flex; padding: 0px 20px;">
			<a href="{% url 'post_new' %}" class="comment-btn radius10 ft12"><span>í¬ìŠ¤íŠ¸ ì‘ì„±</span></a>
			<div class="search-wrap">
			   <div class="search">
			   		<span data-tooltip="ê²€ìƒ‰ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”" v-if="show_release"></span>
			      	<input type="text" class="searchTerm" placeholder="ê²€ìƒ‰í•˜ê¸°">
			   </div>
			</div>
		</div>
	
		<div v-for="post in posts"
			 v-if="post.approved_post"
			 class="card--container">
			<a :href="'/post/'+post.id+'/'">
				<div class="card--profile">
					<img src="{% static '/img/ic_fair_limit_2w.svg' %}"></img>
					<p>[[ post.author ]]</p>
				</div>
				<ul class="card--wrapper">
					<li class="card--title">[[ post.title ]]</li>
					<pre class="card--content">[[ post.text ]]</pre>
					<span style="font-size: 10px;">[[ post.comments.length ]] ê°œ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤</span>
					<p class="card--date">[[ moment(post.created_date).format('Mì›” Dì¼ HH:mm') ]]</p>
				</ul>
			</a>
		</div>
		<div class="card--container" v-if="posts.length==0">
			<a>
				<div class="card--profile">
					<img src="{% static '/img/ic_fair_limit_2w.svg' %}"></img>
					<p>[[ keyword ]]</p>
				</div>
				<ul class="card--wrapper">
					<li class="card--title">"[[ keyword ]]" ì— ê´€ë ¨ëœ í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</li>
					<pre class="card--content">ê²€ìƒ‰í•œ í‚¤ì›Œë“œì™€ ê´€ë ¨ëœ í¬ìŠ¤íŠ¸ê°€ ì—†ì–´ìš”.<br>"[[ keyword ]]" ì— ê´€ë ¨ëœ ì²« í¬ìŠ¤íŠ¸ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”</pre>
				</ul>
			</a>
		</div>
	</div>
</div>
<br><br>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.0/locale/ko.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">


var post_app = new Vue({
	delimiters: ['[[',']]'],
	el: '#postApp',
	data: {
		posts: [],
		posts2: [],
		hit_posts: [],
		show_release: true,
		keyword: null,
	},
	created() {
		this.getPost('')
		this.getPost2()
		this.searchPost()
		setTimeout(() => this.show_release=false, 9000);
	},
	methods: {

		getPost(keyword) {
			var v=this;
			var url='?search='+keyword
			v.keyword=keyword
			axios.get('/api/v1/blog/'+url)
			.then(function(res){
				v.posts=res.data.reverse()
				v.insertAds(v.posts)
			})
			.catch(function(err){})
		},

		getPost2() {
			var v=this;
			axios.get('/api/v1/blog/')
			.then(function(res){
				v.posts2=res.data
				v.hitPost(v.posts2)
			})
			.catch(function(err){})
		},

		hitPost(post) {
			var v=this;
			post.sort(function(a, b) {
				return b.comments.length - a.comments.length
			})
			post.splice(5)
			v.hit_posts=post
		},

		searchPost() {
			var v=this
			document.addEventListener('keypress', logKey);
			function logKey(e) {
				if(e.which==13) {
					var s=document.getElementsByClassName('searchTerm')[0]
					v.getPost(s.value)
				}
			}
		},

	}
})

</script>
{% include "blog/footer.html" %}
{% endblock %}
